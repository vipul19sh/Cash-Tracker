<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cash Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d1117;
  --panel:#161b22;
  --accent:#3b82f6;
  --text:#e6edf3;
  --danger:#ef4444;
  --success:#22c55e;
  --muted:#8b949e;
}
body{
  font-family:'Outfit',sans-serif;
  background:var(--bg);
  color:var(--text);
  margin:0;
  padding:24px;
}
.container{
  background:var(--panel);
  border-radius:12px;
  padding:24px;
  max-width:900px;
  margin:0 auto 24px auto;
  box-shadow:0 0 20px rgba(0,0,0,.25);
  animation:fadeIn .3s ease;
}
h3{margin-top:0;color:var(--accent);}
table{width:100%;border-collapse:collapse;}
th,td{text-align:center;padding:10px;}
th{color:var(--muted);font-weight:500;border-bottom:1px solid #222;}
tr:nth-child(even){background:#0f141a;}
input[type=text]{width:60px;text-align:center;background:#0d1117;color:var(--text);border:none;font-size:16px;}
button{
  border:none;border-radius:8px;padding:14px 18px;font-weight:600;
  color:#fff;cursor:pointer;transition:.2s;letter-spacing:.3px;
}
button:active{transform:scale(.95);}
button.success{background:var(--success);}
button.danger{background:var(--danger);}
button.accent{background:var(--accent);}
button.secondary{background:#30363d;}
.grid{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
}
.side{
  background:#0d1117;border-radius:8px;padding:16px;
  box-shadow:inset 0 0 8px rgba(0,0,0,.4);
}
.side h3{font-size:18px;}
.quick-buttons{display:flex;flex-wrap:wrap;gap:12px;}
.quick-buttons button{flex:1 1 30%; font-size:18px; padding:18px;}
.summary{margin-top:20px;background:#0d1117;border-radius:8px;padding:14px;}
.floating-bar{
  position:fixed;bottom:16px;right:16px;
  background:var(--accent);padding:12px 24px;border-radius:40px;
  color:#fff;font-weight:600;font-size:18px;
  box-shadow:0 4px 10px rgba(0,0,0,.3);
  animation:pulse 2s infinite;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);} }
@keyframes pulse{
  0%,100%{transform:scale(1);}
  50%{transform:scale(1.05);}
}
#logBox{
  max-height:220px;overflow-y:auto;margin-top:12px;
  background:#0d1117;border-radius:8px;padding:10px;font-size:14px;
}
.hidden{display:none;}
</style>
</head>
<body>

<div class="container" id="setupContainer">
  <h3>Set Opening Balance</h3>
  <table id="startingCashTable"><thead><tr><th>â‚¹</th><th>Count</th></tr></thead><tbody></tbody></table>
  <button class="success" onclick="startDay()">Start Day</button>
</div>

<div class="container hidden" id="mainContainer">
  <div class="grid">
    <div class="side">
      <h3>Customer Gave</h3>
      <div class="quick-buttons" id="customerBtns"></div>
    </div>
    <div class="side">
      <h3>Change Given</h3>
      <div class="quick-buttons" id="changeBtns"></div>
    </div>
  </div>

  <div class="summary" id="cashSummary"></div>
  <div class="floating-bar" id="floatingBar">Total: â‚¹0</div>

  <div style="margin-top:16px;">
    <button class="secondary" onclick="toggleLog()">ðŸ§¾ Log</button>
    <button class="accent" onclick="undo()">â†© Undo</button>
    <button class="danger" onclick="endDay()">End Day</button>
  </div>

  <div id="logBox" class="hidden"></div>
</div>

<script>
const denominations=[500,200,100,50,20,10,5,2,1];
let cashData={}; let transactions=[]; let undoStack=[];
const today=new Date().toISOString().split('T')[0];
const storageKey=`cashData_${today}`;
const txnKey=`transactions_${today}`;
const tbody=document.querySelector("#startingCashTable tbody");

// Initialize opening balance table with + and - buttons
denominations.forEach(d=>{
 const row=document.createElement("tr");
 row.innerHTML=`<td>â‚¹${d}</td>
 <td><div style="display:flex;align-items:center;justify-content:center;gap:6px;">
 <button class='secondary' onclick="adjust('${d}',-1)">-</button>
 <input type='text' id='denom_${d}' value='0' readonly>
 <button class='secondary' onclick="adjust('${d}',1)">+</button></div></td>`;
 tbody.appendChild(row);
});

// Adjust cash table and auto-update
function adjust(denom,diff){
  const el=document.getElementById(`denom_${denom}`);
  let v=parseInt(el.value)||0;
  v=Math.max(0,v+diff);
  el.value=v;
  if(cashData[denom]!==undefined){ cashData[denom]=v; updateSummary(); saveData(); }
}

// Restore saved day if exists
function restoreDay(){
  const savedCash=JSON.parse(localStorage.getItem(storageKey)||"{}");
  const savedTxns=JSON.parse(localStorage.getItem(txnKey)||"[]");
  if(Object.keys(savedCash).length){
    cashData=savedCash; transactions=savedTxns;
    document.getElementById("setupContainer").classList.add("hidden");
    document.getElementById("mainContainer").classList.remove("hidden");
    buildButtons();
    updateSummary();
    refreshLog();
    // Update table inputs too
    denominations.forEach(d=>{
      const el=document.getElementById(`denom_${d}`);
      if(el) el.value = cashData[d]||0;
    });
  }
}

function startDay(){
  denominations.forEach(d=>cashData[d]=parseInt(document.getElementById(`denom_${d}`).value)||0);
  saveData();
  document.getElementById("setupContainer").classList.add("hidden");
  document.getElementById("mainContainer").classList.remove("hidden");
  buildButtons(); updateSummary(); refreshLog();
}

function saveData(){
  localStorage.setItem(storageKey,JSON.stringify(cashData));
  localStorage.setItem(txnKey,JSON.stringify(transactions));
}

function buildButtons(){
  const c=document.getElementById("customerBtns"),g=document.getElementById("changeBtns");
  c.innerHTML=""; g.innerHTML="";
  denominations.forEach(d=>{
    const b1=document.createElement("button"); b1.textContent=`â‚¹${d}`; b1.classList.add("accent");
    b1.onclick=()=>recordTxn(d,"received"); c.appendChild(b1);
    const b2=document.createElement("button"); b2.textContent=`â‚¹${d}`; b2.classList.add("danger");
    b2.onclick=()=>recordTxn(d,"given"); g.appendChild(b2);
  });
}

function recordTxn(denom,type){
  undoStack.push(JSON.parse(JSON.stringify(cashData)));
  if(type==="received") cashData[denom]++;
  else if(cashData[denom]>0) cashData[denom]--;
  else return alert("Not enough notes!");
  transactions.push({time:new Date().toLocaleTimeString(),denom,type});
  saveData(); updateSummary(); refreshLog();
}

function undo(){
  if(undoStack.length){
    cashData=undoStack.pop();
    transactions.pop();
    updateSummary(); refreshLog(); saveData();
  }
}

function updateSummary(){
  let total=0;
  let html="<table><tr><th>â‚¹</th><th>Count</th><th>Amount</th></tr>";
  denominations.forEach(d=>{
    const c=cashData[d]||0;
    const amt=c*d;
    total+=amt;
    html+=`<tr><td>${d}</td><td>${c}</td><td>â‚¹${amt}</td></tr>`;
  });
  html+=`<tr><th colspan='2'>Total</th><th>â‚¹${total}</th></tr></table>`;
  document.getElementById("cashSummary").innerHTML=html;
  document.getElementById("floatingBar").textContent=`Total: â‚¹${total}`;
}

function refreshLog(){
  const lb=document.getElementById("logBox"); lb.innerHTML="";
  transactions.slice().reverse().forEach(txn=>{
    const el=document.createElement("div");
    el.textContent=`[${txn.time}] ${txn.type==="received"?"Received":"Given"} â‚¹${txn.denom}`;
    lb.appendChild(el);
  });
}

function toggleLog(){
  document.getElementById("logBox").classList.toggle("hidden");
}

function endDay(){
  alert("Day Ended!");
  localStorage.removeItem(storageKey);
  localStorage.removeItem(txnKey);
  location.reload();
}

// Restore day on load
window.onload = restoreDay;
</script>

</body>
</html>
